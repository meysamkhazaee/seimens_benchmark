        -:    0:Source:tcas.c
        -:    0:Graph:tcas.gcno
        -:    0:Data:tcas.gcda
        -:    0:Runs:1608
        -:    1:#include <stdio.h>
        -:    2:
        -:    3:#define OLEV       600		/* in feets/minute */
        -:    4:#define MAXALTDIFF 600		/* max altitude difference in feet */
        -:    5:#define MINSEP     300          /* min separation in feet */
        -:    6:#define NOZCROSS   100		/* in feet */
        -:    7:				/* variables */
        -:    8:
        -:    9:FILE* file_name = NULL;
        -:   10:typedef int bool;
        -:   11:
        -:   12:int Cur_Vertical_Sep;
        -:   13:bool High_Confidence;
        -:   14:bool Two_of_Three_Reports_Valid;
        -:   15:
        -:   16:int Own_Tracked_Alt;
        -:   17:int Own_Tracked_Alt_Rate;
        -:   18:int Other_Tracked_Alt;
        -:   19:
        -:   20:int Alt_Layer_Value;		/* 0, 1, 2, 3 */
        -:   21:int Positive_RA_Alt_Thresh[4];
        -:   22:
        -:   23:int Up_Separation;
        -:   24:int Down_Separation;
        -:   25:
        -:   26:int Other_RAC;			/* NO_INTENT, DO_NOT_CLIMB, DO_NOT_DESCEND */
        -:   27:#define NO_INTENT 0
        -:   28:#define DO_NOT_CLIMB 1
        -:   29:#define DO_NOT_DESCEND 2
        -:   30:
        -:   31:int Other_Capability;		/* TCAS_TA, OTHER */
        -:   32:#define TCAS_TA 1
        -:   33:#define OTHER 2
        -:   34:
        -:   35:int Climb_Inhibit;		/* true/false */
        -:   36:
        -:   37:#define UNRESOLVED 0
        -:   38:#define UPWARD_RA 1
        -:   39:#define DOWNWARD_RA 2
        -:   40:
     1578:   41:void initialize()
        -:   42:{
     1578:   43:    fprintf(file_name,"P4,");
     1578:   44:    Positive_RA_Alt_Thresh[0] = 400;
     1578:   45:    Positive_RA_Alt_Thresh[1] = 500;
     1578:   46:    Positive_RA_Alt_Thresh[2] = 640;
     1578:   47:    Positive_RA_Alt_Thresh[3] = 740;
     1578:   48:}
        -:   49:
     1128:   50:int ALIM ()
        -:   51:{
     1128:   52:    fprintf(file_name,"P5,");
     1128:   53:    return Positive_RA_Alt_Thresh[Alt_Layer_Value];
        -:   54:}
        -:   55:
     1772:   56:int Inhibit_Biased_Climb ()
        -:   57:{
     1772:   58:    fprintf(file_name,"P6,");
     1772:   59:    return (Climb_Inhibit ? Up_Separation + NOZCROSS : Up_Separation);
        -:   60:}
        -:   61:
      886:   62:bool Non_Crossing_Biased_Climb()
        -:   63:{
      886:   64:    fprintf(file_name,"P7,");
        -:   65:    int upward_preferred;
        -:   66:    int upward_crossing_situation;
        -:   67:    bool result;
        -:   68:
      886:   69:    upward_preferred = Inhibit_Biased_Climb() > Down_Separation;
      886:   70:    fprintf(file_name,"P8,");
      886:   71:    if (upward_preferred)
        -:   72:    {
      478:   73:        fprintf(file_name,"P9,");
      478:   74:		result = !(Own_Below_Threat()) || ((Own_Below_Threat()) && (!(Down_Separation >= ALIM())));
      478:   75:		result = result && (Own_Tracked_Alt <= Other_Tracked_Alt);
        -:   76:    }
        -:   77:    else
        -:   78:    {	
      408:   79:        fprintf(file_name,"P10,");
      408:   80:		result = Own_Above_Threat() && (Cur_Vertical_Sep >= MINSEP) && (Up_Separation >= ALIM());
     408*:   81:		result = result && (Own_Tracked_Alt < Other_Tracked_Alt);
        -:   82:    }
      886:   83:    fprintf(file_name,"P11,");
      886:   84:    return result;
        -:   85:}
        -:   86:
      886:   87:bool Non_Crossing_Biased_Descend()
        -:   88:{
      886:   89:    fprintf(file_name,"P12,");
        -:   90:    int upward_preferred;
        -:   91:    int upward_crossing_situation;
        -:   92:    bool result;
        -:   93:
      886:   94:    upward_preferred = Inhibit_Biased_Climb() > Down_Separation;
      886:   95:    fprintf(file_name,"P13,");
      886:   96:    if (upward_preferred)
        -:   97:    {
      478:   98:        fprintf(file_name,"P14,");
      478:   99:	    result = Own_Below_Threat() && (Cur_Vertical_Sep >= MINSEP) && (Down_Separation >= ALIM());
        -:  100:    }
        -:  101:    else
        -:  102:    {
      408:  103:        fprintf(file_name,"P15,");
      408:  104:	    result = !(Own_Above_Threat()) || ((Own_Above_Threat()) && (Up_Separation >= ALIM()));
        -:  105:    }
      886:  106:    fprintf(file_name,"P16,");
      886:  107:    return result;
        -:  108:}
        -:  109:
     1275:  110:bool Own_Below_Threat()
        -:  111:{
     1275:  112:    fprintf(file_name,"P17,");
     1275:  113:    return (Own_Tracked_Alt < Other_Tracked_Alt);
        -:  114:}
        -:  115:
     1521:  116:bool Own_Above_Threat()
        -:  117:{
     1521:  118:    fprintf(file_name,"P18,");
     1521:  119:    return (Other_Tracked_Alt < Own_Tracked_Alt);
        -:  120:}
        -:  121:
     1578:  122:int alt_sep_test()
        -:  123:{
     1578:  124:    fprintf(file_name,"P19,");
        -:  125:    bool enabled, tcas_equipped, intent_not_known;
        -:  126:    bool need_upward_RA, need_downward_RA;
        -:  127:    int alt_sep;
        -:  128:
     1578:  129:    enabled = High_Confidence && (Own_Tracked_Alt_Rate <= OLEV) && (Cur_Vertical_Sep > MAXALTDIFF);
     1578:  130:    tcas_equipped = Other_Capability == TCAS_TA;
     1578:  131:    intent_not_known = Two_of_Three_Reports_Valid && Other_RAC == NO_INTENT;
        -:  132:    
     1578:  133:    alt_sep = UNRESOLVED;
     1578:  134:    fprintf(file_name,"P20,");
     1578:  135:    if (enabled && ((tcas_equipped && intent_not_known) || !tcas_equipped))
        -:  136:    {
      886:  137:        fprintf(file_name,"P21,");
      886:  138:		need_upward_RA = Non_Crossing_Biased_Climb();
      886:  139:        need_downward_RA = Non_Crossing_Biased_Descend() && Own_Above_Threat();
      886:  140:        fprintf(file_name,"P22,");
      886:  141:        if (need_upward_RA && need_downward_RA)
        -:  142:        {
    #####:  143:            fprintf(file_name,"P23,");
        -:  144:            /* unreachable: requires Own_Below_Threat and Own_Above_Threat
        -:  145:            to both be true - that requires Own_Tracked_Alt < Other_Tracked_Alt
        -:  146:            and Other_Tracked_Alt < Own_Tracked_Alt, which isn't possible */
    #####:  147:            alt_sep = UNRESOLVED;
        -:  148:        }
      886:  149:        else if (need_upward_RA)
        -:  150:        {
      159:  151:            fprintf(file_name,"P24,");
      159:  152:            alt_sep = UPWARD_RA;
        -:  153:        }
      727:  154:        else if (need_downward_RA)
        -:  155:        {
      123:  156:            fprintf(file_name,"P25,");
      123:  157:            alt_sep = DOWNWARD_RA;
        -:  158:        }
        -:  159:        else
        -:  160:        {
      604:  161:            fprintf(file_name,"P26,");
      604:  162:            alt_sep = UNRESOLVED;
        -:  163:        }    
        -:  164:    }
     1578:  165:    fprintf(file_name,"P27,");
     1578:  166:    return alt_sep;
        -:  167:}
        -:  168:
     1608:  169:main(argc, argv)
        -:  170:int argc;
        -:  171:char *argv[];
        -:  172:{
     1608:  173:    file_name=fopen("v31.txt","a+"); 
     1608:  174:    if(!file_name)
        -:  175:    {	
    #####:  176:        printf("File could not be opened! \n");
    #####:  177:        fclose(file_name);
    #####:  178:        exit(0);
        -:  179:    }
        -:  180:
     1608:  181:    fprintf(file_name,"\nP1,");
     1608:  182:    if(argc < 13)
        -:  183:    {
       30:  184:        fprintf(file_name,"P2,");
       30:  185:        fprintf(stdout, "Error: Command line arguments are\n");
       30:  186:        fprintf(stdout, "Cur_Vertical_Sep, High_Confidence, Two_of_Three_Reports_Valid\n");
       30:  187:        fprintf(stdout, "Own_Tracked_Alt, Own_Tracked_Alt_Rate, Other_Tracked_Alt\n");
       30:  188:        fprintf(stdout, "Alt_Layer_Value, Up_Separation, Down_Separation\n");
       30:  189:        fprintf(stdout, "Other_RAC, Other_Capability, Climb_Inhibit\n");
       30:  190:        exit(1);
        -:  191:    }
     1578:  192:    fprintf(file_name,"P3,");
     1578:  193:    initialize();
     1578:  194:    Cur_Vertical_Sep = atoi(argv[1]);
     1578:  195:    High_Confidence = atoi(argv[2]);
     1578:  196:    Two_of_Three_Reports_Valid = atoi(argv[3]);
     1578:  197:    Own_Tracked_Alt = atoi(argv[4]);
     1578:  198:    Own_Tracked_Alt_Rate = atoi(argv[5]);
     1578:  199:    Other_Tracked_Alt = atoi(argv[6]);
     1578:  200:    Alt_Layer_Value = atoi(argv[7]);
     1578:  201:    Up_Separation = atoi(argv[8]);
     1578:  202:    Down_Separation = atoi(argv[9]);
     1578:  203:    Other_RAC = atoi(argv[10]);
     1578:  204:    Other_Capability = atoi(argv[11]);
     1578:  205:    Climb_Inhibit = atoi(argv[12]);
        -:  206:
     1578:  207:    fprintf(stdout, "%d\n", alt_sep_test());
     1578:  208:    exit(0);
        -:  209:}
