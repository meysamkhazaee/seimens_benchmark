        -:    0:Source:replace_instrumented.c
        -:    0:Graph:replace_instrumented.gcno
        -:    0:Data:replace_instrumented.gcda
        -:    0:Runs:5542
        -:    1:/*  -*- Last-Edit:  Mon Dec  7 10:31:51 1992 by Tarak S. Goradia; -*- */
        -:    2:
        -:    3:extern void	exit();
        -:    4:# include <stdio.h>
        -:    5:#include <signal.h>
        -:    6:
        -:    7:void	Caseerror();
        -:    8:
        -:    9:typedef char	bool;
        -:   10:# define false 0
        -:   11:# define true  1
        -:   12:# define NULL 0
        -:   13:
        -:   14:# define MAXSTR 100
        -:   15:# define MAXPAT MAXSTR
        -:   16:
        -:   17:# define ENDSTR  '\0'
        -:   18:# define ESCAPE  '@'
        -:   19:# define CLOSURE '*'
        -:   20:# define BOL     '%'
        -:   21:# define EOL     '$'
        -:   22:# define ANY     '?'
        -:   23:# define CCL     '['
        -:   24:# define CCLEND  ']'
        -:   25:# define NEGATE  '^'
        -:   26:# define NCCL    '!'
        -:   27:# define LITCHAR 'c'
        -:   28:# define DITTO   -1
        -:   29:# define DASH    '-'
        -:   30:
        -:   31:# define TAB     9
        -:   32:# define NEWLINE 10
        -:   33:
        -:   34:# define CLOSIZE 1
        -:   35:FILE* file_name = NULL;
        -:   36:
        -:   37:// Signal handler for SIGSEGV 
        -:   38:// add by mshadow
    #####:   39:void segfault_handler(int sig) {
    #####:   40:    exit(sig);  // Exit the program
        -:   41:}
        -:   42:
        -:   43:
        -:   44:typedef char	character;
        -:   45:typedef char string[MAXSTR];
        -:   46:
        -:   47:bool
    13809:   48:get_line(s, maxsize)
        -:   49:char *s;
        -:   50:int	maxsize;
        -:   51:{
    13809:   52:	fprintf(file_name,"P11,");
        -:   53:    char *result;
    13809:   54:    result = fgets(s, maxsize, stdin);
    13809:   55:    return (result != NULL);
        -:   56:}
        -:   57:
        -:   58:int
   168966:   59:addstr(c, outset, j, maxset)
        -:   60:char c;
        -:   61:char *outset;
        -:   62:int	*j;
        -:   63:int	maxset;
        -:   64:{
        -:   65:    bool result;
   168966:   66:	fprintf(file_name,"P12,");
   168966:   67:    if (*j >= maxset)
        -:   68:	{
    37081:   69:		fprintf(file_name,"P13,");
    37081:   70:		result = false;
        -:   71:	}
        -:   72:    else 
        -:   73:	{
   131885:   74:		fprintf(file_name,"P14,");
   131885:   75:		outset[*j] = c;
   131885:   76:		*j = *j + 1;
   131885:   77:		result = true;
        -:   78:    }
   168966:   79:	fprintf(file_name,"P15,");
   168966:   80:    return result;
        -:   81:}
        -:   82:
        -:   83:char
    72118:   84:esc(s, i)
        -:   85:char *s;
        -:   86:int	*i;
        -:   87:{
        -:   88:    char result;
    72118:   89:	fprintf(file_name,"P16,");
    72118:   90:    if (s[*i] != ESCAPE)
        -:   91:	{
    67260:   92:		fprintf(file_name,"P17,");
    67260:   93:		result = s[*i];
        -:   94:	}
     4858:   95:    else if (s[*i + 1] == ENDSTR)
        -:   96:	{
       52:   97:		fprintf(file_name,"P18,");
       52:   98:		result = ESCAPE;
        -:   99:	}
        -:  100:	else 
        -:  101:	{
     4806:  102:	    *i = *i + 1;
     4806:  103:	    fprintf(file_name,"P19,");
     4806:  104:		if (s[*i] == 'n')
        -:  105:		{
      969:  106:			fprintf(file_name,"P20,");
      969:  107:			result = NEWLINE;
        -:  108:		}
     3837:  109:	    else if (s[*i] == 't')
        -:  110:		{
      756:  111:			fprintf(file_name,"P21,");
      756:  112:			result = TAB;
        -:  113:		}
        -:  114:		else
        -:  115:		{
     3081:  116:			fprintf(file_name,"P22,");
     3081:  117:			result = s[*i];
        -:  118:		}  
        -:  119:	}
    72118:  120:	fprintf(file_name,"P23,");
    72118:  121:    return result;
        -:  122:}
        -:  123:
        -:  124:void change();
        -:  125:
        -:  126:void
     5677:  127:dodash(delim, src, i, dest, j, maxset)
        -:  128:char delim;
        -:  129:char *src;
        -:  130:int	*i;
        -:  131:char *dest;
        -:  132:int	*j;
        -:  133:int	maxset;
        -:  134:{
        -:  135:    int	k;
        -:  136:    bool junk;
        -:  137:    char escjunk;
     5677:  138:	fprintf(file_name,"P24,");
    21685:  139:    while ((src[*i] != delim) && (src[*i] != ENDSTR)) 
        -:  140:    {
    16008:  141:		fprintf(file_name,"P25,");
    16008:  142:		if (src[*i - 1] == ESCAPE) 
        -:  143:		{
      411:  144:			fprintf(file_name,"P26,");
      411:  145:			escjunk = esc(src, i);
      411:  146:			junk = addstr(escjunk, dest, j, maxset);
        -:  147:		} 
    15597:  148:		else if (src[*i] != DASH)
        -:  149:		{
     9561:  150:			fprintf(file_name,"P27,");
     9561:  151:			junk = addstr(src[*i], dest, j, maxset);
        -:  152:		}
     6036:  153:		else if (*j <= 1 || src[*i + 1] == ENDSTR)
        -:  154:		{
       92:  155:			fprintf(file_name,"P28,");
       92:  156:			junk = addstr(DASH, dest, j, maxset);
        -:  157:		}
     5944:  158:		else if ((isalnum(src[*i - 1])) && (isalnum(src[*i + 1])) && (src[*i - 1] <= src[*i + 1]))
        -:  159:		{
     4345:  160:			fprintf(file_name,"P29,");
    35667:  161:			for (k = src[*i-1]+1; k<=src[*i+1]; k++) 
        -:  162:			{
    31322:  163:				fprintf(file_name,"P30,");
    31322:  164:				junk = addstr(k, dest, j, maxset);
        -:  165:			}
     4345:  166:			fprintf(file_name,"P31,");	
     4345:  167:			*i = *i + 1;	
        -:  168:		} 
        -:  169:		else
        -:  170:		{
     1599:  171:			fprintf(file_name,"P32,");
     1599:  172:			junk = addstr(DASH, dest, j, maxset);
        -:  173:		}	
    16008:  174:		fprintf(file_name,"P33,");
    16008:  175:		(*i) = (*i) + 1;
        -:  176:    }
     5677:  177:}
        -:  178:
        -:  179:bool
     5677:  180:getccl(arg, i, pat, j)
        -:  181:char *arg;
        -:  182:int	*i;
        -:  183:char *pat;
        -:  184:int	*j;
        -:  185:{
        -:  186:    int	jstart;
        -:  187:    bool junk;
     5677:  188:    *i = *i + 1;
     5677:  189:	fprintf(file_name,"P34,");
     5677:  190:    if (arg[*i] == NEGATE) 
        -:  191:	{
     2809:  192:		fprintf(file_name,"P35,");
     2809:  193:		junk = addstr(NCCL, pat, j, MAXPAT);
     2809:  194:		*i = *i + 1;
        -:  195:    } 
        -:  196:	else
        -:  197:	{
     2868:  198:		fprintf(file_name,"P36,");
     2868:  199:		junk = addstr(CCL, pat, j, MAXPAT);
        -:  200:	}
     5677:  201:	fprintf(file_name,"P37,");
     5677:  202:    jstart = *j;
     5677:  203:    junk = addstr(0, pat, j, MAXPAT);
     5677:  204:    dodash(CCLEND, arg, i, pat, j, MAXPAT);
     5677:  205:    pat[jstart] = *j - jstart - 1;
     5677:  206:    return (arg[*i] == CCLEND);
        -:  207:}
        -:  208:
        -:  209:void
     1250:  210:stclose(pat, j, lastj)
        -:  211:char *pat;
        -:  212:int	*j;
        -:  213:int	lastj;
        -:  214:{
        -:  215:    int	jt;
        -:  216:    int	jp;
        -:  217:    bool junk;
     1250:  218:	fprintf(file_name,"P38,");
     3749:  219:    for (jp = *j - 1; jp >= lastj ; jp--) 
        -:  220:    {
     2499:  221:		fprintf(file_name,"P39,");
     2499:  222:		jt = jp + CLOSIZE;
     2499:  223:		junk = addstr(pat[jp], pat, &jt, MAXPAT);
        -:  224:    }
     1250:  225:	fprintf(file_name,"P40,");
     1250:  226:    *j = *j + CLOSIZE;
     1250:  227:    pat[lastj] = CLOSURE;
     1250:  228:}
        -:  229:
     1690:  230:bool in_set_2(c)
        -:  231:char c;
        -:  232:{
     1690:  233:	fprintf(file_name,"P41,");
     1690:  234:  	return (c == BOL || c == EOL || c == CLOSURE || c != LITCHAR);
        -:  235:}      
        -:  236:
   249533:  237:bool in_pat_set(c)
        -:  238:char c;
        -:  239:{
   249533:  240:	fprintf(file_name,"P42,");
  249533*:  241:  	return (c == LITCHAR || c == BOL || c == EOL || c == ANY || c == CCL || c == NCCL || c == CLOSURE);
        -:  242:}      
        -:  243:
        -:  244:int
     5520:  245:makepat(arg, start, delim, pat)
        -:  246:char	*arg;
        -:  247:int	start;
        -:  248:char	delim;
        -:  249:char	*pat;
        -:  250:{
        -:  251:    int	result;
        -:  252:    int	i, j, lastj, lj;
        -:  253:    bool done, junk;
        -:  254:    bool getres;
        -:  255:    char escjunk;
        -:  256:
     5520:  257:    j = 0;
     5520:  258:    i = start;
     5520:  259:    lastj = 0;
     5520:  260:    done = false;
     5520:  261:	fprintf(file_name,"P43,");
    41467:  262:    while ((!done) && (arg[i] != delim) && (arg[i] != ENDSTR)) 
        -:  263:	{
    35947:  264:		lj = j;
    35947:  265:		fprintf(file_name,"P44,");
    35947:  266:		if ((arg[i] == ANY))
        -:  267:		{
     3180:  268:			fprintf(file_name,"P45,");
     3180:  269:			junk = addstr(ANY, pat, &j, MAXPAT);
        -:  270:		}
    32767:  271:		else if ((arg[i] == BOL) && (i == start))
        -:  272:		{
      387:  273:			fprintf(file_name,"P46,");
      387:  274:			junk = addstr(BOL, pat, &j, MAXPAT);
        -:  275:		}
    32380:  276:		else if ((arg[i] == EOL) && (arg[i+1] == delim))
        -:  277:		{
      344:  278:			fprintf(file_name,"P47,");
      344:  279:			junk = addstr(EOL, pat, &j, MAXPAT);
        -:  280:		}
    32036:  281:		else if ((arg[i] == CCL)) 
        -:  282:		{
     5677:  283:			fprintf(file_name,"P48,");
     5677:  284:			getres = getccl(arg, &i, pat, &j);
     5677:  285:			done = (bool)(getres == false);
        -:  286:		} 
    26359:  287:		else if ((arg[i] == CLOSURE) && (i > start)) 
        -:  288:		{
     1690:  289:			fprintf(file_name,"P49,");
     1690:  290:			lj = lastj;
     1690:  291:			if (in_set_2(pat[lj]))
        -:  292:			{
      440:  293:				fprintf(file_name,"P50,");
      440:  294:				done = true;
        -:  295:			}	
        -:  296:			else
        -:  297:			{
     1250:  298:				fprintf(file_name,"P51,");
     1250:  299:				stclose(pat, &j, lastj);
        -:  300:			}
        -:  301:		} 
        -:  302:		else 
        -:  303:		{
    24669:  304:			fprintf(file_name,"P52,");
    24669:  305:			junk = addstr(LITCHAR, pat, &j, MAXPAT);
    24669:  306:			escjunk = esc(arg, &i);
    24669:  307:			junk = addstr(escjunk, pat, &j, MAXPAT);
        -:  308:		}
        -:  309:		
    35947:  310:		lastj = lj;
    35947:  311:		fprintf(file_name,"P53,");
    35947:  312:		if ((!done))
        -:  313:		{
    35201:  314:			fprintf(file_name,"P54,");
    35201:  315:			i = i + 1;
        -:  316:		}
        -:  317:    }	
     5520:  318:    junk = addstr(ENDSTR, pat, &j, MAXPAT);
     5520:  319:    fprintf(file_name,"P55,");
     5520:  320:	if ((done) || (arg[i] != delim))
        -:  321:	{
      746:  322:		fprintf(file_name,"P56,");
      746:  323:		result = 0;
        -:  324:	}
     4774:  325:    else if ((!junk))
        -:  326:	{
       48:  327:		fprintf(file_name,"P57,");
       48:  328:		result = 0;
        -:  329:	}
        -:  330:	else
        -:  331:	{
     4726:  332:		fprintf(file_name,"P58,");
     4726:  333:		result = i;
        -:  334:	}
     5520:  335:	fprintf(file_name,"P59,");
     5520:  336:    return result;
        -:  337:}
        -:  338:
        -:  339:int
     5520:  340:getpat(arg, pat)
        -:  341:char* arg;
        -:  342:char* pat;
        -:  343:{
     5520:  344:	fprintf(file_name,"P60,");
        -:  345:    int	makeres;
     5520:  346:    makeres = makepat(arg, 0, ENDSTR, pat);
     5520:  347:    return (makeres > 0);
        -:  348:}
        -:  349:
        -:  350:int
     4567:  351:makesub(arg, from, delim, sub)
        -:  352:char* arg;
        -:  353:int	from;
        -:  354:character delim;
        -:  355:char*	sub;
        -:  356:{
        -:  357:    int  result;
        -:  358:    int	i, j;
        -:  359:    bool	junk;
        -:  360:    character	escjunk;
        -:  361:
     4567:  362:    j = 0;
     4567:  363:    i = from;
        -:  364:
     4567:  365:	fprintf(file_name,"P61,");
    53359:  366:    while ((arg[i] != delim) && (arg[i] != ENDSTR)) 
        -:  367:	{
    48792:  368:		fprintf(file_name,"P62,");
    48792:  369:		if ((arg[i] == (unsigned)('&')))
        -:  370:		{
     1754:  371:			fprintf(file_name,"P63,");
     1754:  372:			junk = addstr(DITTO, sub, &j, MAXPAT);
        -:  373:		}
        -:  374:		else 
        -:  375:		{
    47038:  376:			fprintf(file_name,"P64,");
    47038:  377:			escjunk = esc(arg, &i);
    47038:  378:			junk = addstr(escjunk, sub, &j, MAXPAT);
        -:  379:		}
    48792:  380:		fprintf(file_name,"P65,");
    48792:  381:		i = i + 1;
        -:  382:    }
     4567:  383:	fprintf(file_name,"P66,");
     4567:  384:    if (arg[i] != delim)
        -:  385:	{
    #####:  386:		fprintf(file_name,"P67,");
    #####:  387:		result = 0;
        -:  388:	}
        -:  389:    else 
        -:  390:	{
     4567:  391:		junk = addstr(ENDSTR, &(*sub), &j, MAXPAT);
     4567:  392:		fprintf(file_name,"P68,");
     4567:  393:		if ((!junk))
        -:  394:		{
       62:  395:			fprintf(file_name,"P69,");
       62:  396:			result = 0;
        -:  397:		}
        -:  398:		else
        -:  399:		{
     4505:  400:			fprintf(file_name,"P70,");
     4505:  401:			result = i;
        -:  402:		}	
        -:  403:    }
     4567:  404:	fprintf(file_name,"P71,");	
     4567:  405:    return result;
        -:  406:}
        -:  407:
        -:  408:bool
     4567:  409:getsub(arg, sub)
        -:  410:char* arg;
        -:  411:char* sub;
        -:  412:{
     4567:  413:	fprintf(file_name,"P72,");
        -:  414:    int	makeres;
     4567:  415:    makeres = makesub(arg, 0, ENDSTR, sub);
     4567:  416:    return (makeres > 0);
        -:  417:}
        -:  418:
        -:  419:void subline();
        -:  420:
        -:  421:bool
    30769:  422:locate(c, pat, offset)
        -:  423:character c;
        -:  424:char* pat;
        -:  425:int	offset;
        -:  426:{
        -:  427:    int	i;
        -:  428:    bool flag;
    30769:  429:    flag = false;
    30769:  430:    i = offset + pat[offset];
        -:  431:
    30769:  432:    fprintf(file_name,"P73,");
   255038:  433:	while ((i > offset))
        -:  434:    {
   224269:  435:		fprintf(file_name,"P74,");
   224269:  436:		if (c == pat[i]) 
        -:  437:		{
     4981:  438:			fprintf(file_name,"P75,");
     4981:  439:			flag = true;
     4981:  440:			i = offset;
        -:  441:		} 
        -:  442:		else
        -:  443:		{
   219288:  444:			fprintf(file_name,"P76,");
   219288:  445:			i = i - 1;
        -:  446:		}
        -:  447:    }
        -:  448:
    30769:  449:	fprintf(file_name,"P77,");
    30769:  450:    return flag;
        -:  451:}
        -:  452:
        -:  453:bool
   172370:  454:omatch(lin, i, pat, j)
        -:  455:char* lin;
        -:  456:int	*i;
        -:  457:char* pat;
        -:  458:int	j;
        -:  459:{
        -:  460:    char advance;
        -:  461:    bool result;
   172370:  462:    advance = -1;
        -:  463:
   172370:  464:	fprintf(file_name,"P78,");
   172370:  465:    if ((lin[*i] == ENDSTR))
        -:  466:	{
      366:  467:		fprintf(file_name,"P79,");
      366:  468:		result = false;
        -:  469:	}
        -:  470:    else 
        -:  471:    {
   172004:  472:		fprintf(file_name,"P80,");
   172004:  473:		if (!in_pat_set(pat[j]))
        -:  474:		{
    #####:  475:			fprintf(file_name,"P81,");
    #####:  476:			(void)fprintf(stdout, "in omatch: can't happen\n");
    #####:  477:			abort();	
        -:  478:		} 
        -:  479:		else
        -:  480:		{
   172004:  481:			fprintf(file_name,"P82,");
   172004:  482:			switch (pat[j]) 
        -:  483:			{			
   112281:  484:				case LITCHAR:
   112281:  485:					fprintf(file_name,"P83,");
   112281:  486:					if (lin[*i] == pat[j + 1])
        -:  487:					{
    25054:  488:						fprintf(file_name,"P84,");
    25054:  489:						advance = 1;
        -:  490:					}
   112281:  491:					fprintf(file_name,"P85,");
   112281:  492:					break ;	
     5869:  493:				case BOL:
     5869:  494:					fprintf(file_name,"P86,");
     5869:  495:					if (*i == 0)
        -:  496:					{
      604:  497:						fprintf(file_name,"P87,");
      604:  498:						advance = 0;
        -:  499:					}
     5869:  500:					fprintf(file_name,"P88,");
     5869:  501:					break ;
    19142:  502:				case ANY:
    19142:  503:				    fprintf(file_name,"P89,");
    19142:  504:					if (lin[*i] != NEWLINE)
        -:  505:					{
    17845:  506:						fprintf(file_name,"P90,");
    17845:  507:						advance = 1;
        -:  508:					}
    19142:  509:					fprintf(file_name,"P91,");
    19142:  510:					break ;
     3040:  511:				case EOL:
     3040:  512:				 	fprintf(file_name,"P92,");
     3040:  513:					if (lin[*i] == NEWLINE)
        -:  514:					{
      503:  515:						fprintf(file_name,"P93,");
      503:  516:						advance = 0;
        -:  517:					}
     3040:  518:					fprintf(file_name,"P94,");	
     3040:  519:					break ;
    17228:  520:				case CCL:
    17228:  521:					fprintf(file_name,"P95,");
    17228:  522:					if (locate(lin[*i], pat, j + 1))
        -:  523:					{
     3598:  524:						fprintf(file_name,"P96,");
     3598:  525:						advance = 1;
        -:  526:					}
    17228:  527:					fprintf(file_name,"P97,");
    17228:  528:					break ;
    14444:  529:				case NCCL:
    14444:  530:					fprintf(file_name,"P98,");
    14444:  531:					if ((lin[*i] != NEWLINE) && (!locate(lin[*i], pat, j+1)))
        -:  532:					{
    12158:  533:						fprintf(file_name,"P99,");
    12158:  534:						advance = 1;	
        -:  535:					}
    14444:  536:					fprintf(file_name,"P100,");
    14444:  537:					break;
    #####:  538:				default:
    #####:  539:					fprintf(file_name,"P101,");
    #####:  540:					Caseerror(pat[j]);
        -:  541:			};
        -:  542:		}	
        -:  543:    }
   172370:  544:    if ((advance >= 0)) 
        -:  545:    {
    59762:  546:		fprintf(file_name,"P102,");
    59762:  547:		*i = *i + advance;
    59762:  548:		result = true;
        -:  549:    } 
        -:  550:	else
        -:  551:	{
   112608:  552:		fprintf(file_name,"P103,");
   112608:  553:		result = false;
        -:  554:	}
   172370:  555:	fprintf(file_name,"P104,");
   172370:  556:    return result;
        -:  557:}
        -:  558:
        -:  559:
    77529:  560:patsize(pat, n)
        -:  561:char*	pat;
        -:  562:int	n;
        -:  563:{
        -:  564:    int size;
    77529:  565:	fprintf(file_name,"P105,");
    77529:  566:    if (!in_pat_set(pat[n])) 
        -:  567:	{
    #####:  568:		fprintf(file_name,"P106,");
    #####:  569:		(void)fprintf(stdout, "in patsize: can't happen\n");
    #####:  570:		abort();
        -:  571:    } 
        -:  572:	else
        -:  573:	{
    77529:  574:		fprintf(file_name,"P107,");
    77529:  575:		switch (pat[n]) 
        -:  576:		{
    32505:  577:		case LITCHAR: 
    32505:  578:			fprintf(file_name,"P108,");
    32505:  579:			size = 2; 
    32505:  580:			break;
        -:  581:			
    18952:  582:		case BOL:  
        -:  583:		case EOL:  
        -:  584:		case ANY:
    18952:  585:			fprintf(file_name,"P109,");
    18952:  586:			size = 1;
    18952:  587:			break;
    15756:  588:		case CCL:  
        -:  589:		case NCCL:
    15756:  590:			fprintf(file_name,"P110,");
    15756:  591:			size = pat[n + 1] + 2;
    15756:  592:			break ;
    10316:  593:		case CLOSURE:
    10316:  594:			fprintf(file_name,"P111,");
    10316:  595:			size = CLOSIZE;
    10316:  596:			break ;
    #####:  597:		default:
    #####:  598:			fprintf(file_name,"P112,");
    #####:  599:			Caseerror(pat[n]);
        -:  600:		}
        -:  601:	}
        -:  602:
    77529:  603:    return size;
        -:  604:}
        -:  605:
        -:  606:int
   137031:  607:amatch(lin, offset, pat, j)
        -:  608:char*	lin;
        -:  609:int	offset;
        -:  610:char*	pat;
        -:  611:int	j;
        -:  612:{
        -:  613:    int	i, k;
        -:  614:    bool result, done;
   137031:  615:    done = false;
        -:  616:
   137031:  617:	fprintf(file_name,"P113,");
   304470:  618:    while ((!done) && (pat[j] != ENDSTR))
        -:  619:	{
   167439:  620:		fprintf(file_name,"P114,");
   167439:  621:		if ((pat[j] == CLOSURE)) 
        -:  622:		{
    10316:  623:			j = j + patsize(pat, j);
    10316:  624:			i = offset;
    10316:  625:			fprintf(file_name,"P115,");
    25563:  626:			while ((!done) && (lin[i] != ENDSTR)) 
        -:  627:			{
    15247:  628:				result = omatch(lin, &i, pat, j);
    15247:  629:				fprintf(file_name,"P115,");
    15247:  630:				if (!result)
        -:  631:				{
    10100:  632:					fprintf(file_name,"P117,");
    10100:  633:					done = true;
        -:  634:				}		
        -:  635:			}
    10316:  636:			done = false;
    10316:  637:			fprintf(file_name,"P118,");
    22914:  638:			while ((!done) && (i >= offset)) 
        -:  639:			{
    12598:  640:				k = amatch(lin, i, pat, j + patsize(pat, j));
    12598:  641:				fprintf(file_name,"P119,");
    12598:  642:				if ((k >= 0))
        -:  643:				{
     4697:  644:					fprintf(file_name,"P120,");
     4697:  645:					done = true;
        -:  646:				}
        -:  647:				else
        -:  648:				{
     7901:  649:					fprintf(file_name,"P121,");
     7901:  650:					i = i - 1;
        -:  651:				}	
        -:  652:			}
    10316:  653:			fprintf(file_name,"P122,");
    10316:  654:			offset = k;
    10316:  655:			done = true;
        -:  656:		} 
        -:  657:		else 
        -:  658:		{
   157123:  659:			result = omatch(lin, &offset, pat, j);
   157123:  660:			fprintf(file_name,"P123,");
   157123:  661:			if ((!result)) 
        -:  662:			{
   102508:  663:				fprintf(file_name,"P124,");
   102508:  664:				offset = -1;
   102508:  665:				done = true;
        -:  666:			}
        -:  667:			else
        -:  668:			{
    54615:  669:				fprintf(file_name,"P125,");
    54615:  670:				j = j + patsize(pat, j);
        -:  671:			}
        -:  672:		}
        -:  673:	}
   137031:  674:	fprintf(file_name,"P126,");
   137031:  675:	return offset;
        -:  676:}
        -:  677:
        -:  678:void
    24049:  679:putsub(lin, s1, s2, sub)
        -:  680:char* lin;
        -:  681:int	s1, s2;
        -:  682:char* sub;
        -:  683:{
        -:  684:    int	i;
        -:  685:    int	j;
    24049:  686:    i = 0;
    24049:  687:	fprintf(file_name,"P127,");
   332492:  688:    while ((sub[i] != ENDSTR)) 
        -:  689:	{
   308443:  690:		fprintf(file_name,"P128,");
   308443:  691:		if ((sub[i] == DITTO))
        -:  692:		{
    11101:  693:			fprintf(file_name,"P129,");
    25106:  694:			for (j = s1; j < s2; j++) 
        -:  695:		    {
    14005:  696:				fprintf(file_name,"P130,");
    14005:  697:				fputc(lin[j],stdout);
        -:  698:		    }
        -:  699:		}
        -:  700:		else	
        -:  701:		{
   297342:  702:			fprintf(file_name,"P131,");
   297342:  703:		    fputc(sub[i],stdout);
        -:  704:		}
   308443:  705:		fprintf(file_name,"P132,");
   308443:  706:		i = i + 1;
        -:  707:    }
    24049:  708:}
        -:  709:
        -:  710:void
     9426:  711:subline(lin, pat, sub)
        -:  712:char *lin;
        -:  713:char *pat;
        -:  714:char *sub;
        -:  715:{	
        -:  716:	int	i, lastm, m;
     9426:  717:	lastm = -1;
     9426:  718:	i = 0;
     9426:  719:	fprintf(file_name,"P133,");
   133859:  720:	while ((lin[i] != ENDSTR)) 
        -:  721:	{
   124433:  722:	    m = amatch(lin, i, pat, 0);
   124433:  723:	    fprintf(file_name,"P134,");
   124433:  724:		if ((m >= 0) && (lastm != m)) 
        -:  725:		{
    24049:  726:			fprintf(file_name,"P135,");
    24049:  727:			putsub(lin, i, m, sub);
    24049:  728:			lastm = m;
        -:  729:	    }
   124433:  730:		fprintf(file_name,"P136,");
   124433:  731:	    if ((m == -1) || (m == i))
        -:  732:		{
   102680:  733:			fprintf(file_name,"P137,");
   102680:  734:			fputc(lin[i],stdout);
   102680:  735:			i = i + 1;
        -:  736:	    } 
        -:  737:		else
        -:  738:		{
    21753:  739:			fprintf(file_name,"P138,");
    21753:  740:			i = m;
        -:  741:		}
        -:  742:	}
     9426:  743:}
        -:  744:
        -:  745:void
     4383:  746:change(pat, sub)
        -:  747:char *pat, *sub;
        -:  748:{
        -:  749:    string  line;
        -:  750:    bool result;
     4383:  751:    result = get_line(line, MAXSTR);
        -:  752:	
     4383:  753:    fprintf(file_name,"P139,");
    13809:  754:	while ((result)) 
        -:  755:	{
     9426:  756:		fprintf(file_name,"P140,");
     9426:  757:		subline(line, pat, sub);
     9426:  758:		result = get_line(line, MAXSTR);
        -:  759:    }
     4383:  760:}
        -:  761:
     5542:  762:main(argc, argv)
        -:  763:int	argc;
        -:  764:char	*argv[];
        -:  765:{
     5542:  766:	signal(SIGSEGV, segfault_handler);
     5542:  767:	file_name=fopen("v30.txt","a+"); 
     5542:  768:    if(!file_name)
        -:  769:    {	
    #####:  770:        printf("File could not be opened! \n");
    #####:  771:        fclose(file_name);
    #####:  772:        exit(0);
        -:  773:    }
        -:  774:	string pat, sub;
        -:  775:	bool result;
        -:  776:
     5542:  777:	fprintf(file_name,"\nP1,");
     5542:  778:	if (argc < 2) 
        -:  779:	{
       22:  780:		fprintf(file_name,"P2,");
       22:  781:		(void)fprintf(stdout, "usage: change from [to]\n");
       22:  782:		exit(1);
        -:  783:	};
        -:  784:	
     5520:  785:	result = getpat(argv[1], pat);
     5520:  786:	fprintf(file_name,"P3,");
     5520:  787:	if (!result)
        -:  788:	{
      854:  789:		fprintf(file_name,"P4,");
      854:  790:		(void)fprintf(stdout, "change: illegal \"from\" pattern\n");
      854:  791:		exit(2);
        -:  792:	}
        -:  793:
     4666:  794:	fprintf(file_name,"P5,");
     4666:  795:	if (argc >= 3)
        -:  796:	{
     4567:  797:		result = getsub(argv[2], sub);
     4567:  798:		fprintf(file_name,"P6,");
     4567:  799:		if (!result)
        -:  800:		{	
      283:  801:			fprintf(file_name,"P7,");
      283:  802:			(void)fprintf(stdout, "change: illegal \"to\" string\n");
      283:  803:			exit(3);
        -:  804:		}
        -:  805:	} 
        -:  806:	else
        -:  807:	{
       99:  808:		fprintf(file_name,"P8,");
       99:  809:		sub[0] = '\0';
        -:  810:	}
        -:  811:
     4383:  812:	fprintf(file_name,"P9,");
     4383:  813:	change(pat, sub);
     4383:  814:	return 0;
        -:  815:}
        -:  816:
        -:  817:void
    #####:  818:Caseerror(n)
        -:  819:int	n;
        -:  820:{
    #####:  821:	fprintf(file_name,"P10,");
    #####:  822:	(void)fprintf(stdout, "Missing case limb: line %d\n", n);
    #####:  823:	exit(4);
        -:  824:}
